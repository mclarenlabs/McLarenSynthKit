<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Introduction - McLaren Synth Kit</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/console.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/objc.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">McLaren Synth Kit</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Introduction</a>
                            </li>
                            <li class="navitem">
                                <a href="../setup/" class="nav-link">GNUstep and VSCode</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Thing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../one" class="dropdown-item">None</a>
</li>
                                    
<li>
    <a href="../two" class="dropdown-item">None</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../setup/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#introduction-to-the-mclaren-synth-kit" class="nav-link">Introduction to the Mclaren Synth Kit</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#background" class="nav-link">Background</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#concurrency" class="nav-link">Concurrency</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#a-brief-tour-of-the-components" class="nav-link">A Brief Tour of the Components</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="introduction-to-the-mclaren-synth-kit">Introduction to the Mclaren Synth Kit</h1>
<p>The McLaren Synth Kit aims to bring audio programming to Objective-C on Linux.  It consists of two parts.</p>
<ol>
<li>Alsa Sound Kit (ASK) - Obj-C wrappers around Alsa sound and MIDI devices</li>
<li>Mclaren Synth Kit (MSK) - a more abstract sound "context" and synthesizer construction operators like oscillators, envelopes and effects.</li>
</ol>
<p>These tool kits are distributed as header files and static libraries compiled for specific compiler and runtime combinations.</p>
<p>FYI: These are the same libraries McLaren Labs uses to construct the synthesizers that are available for free download at <a href="https://mclarenlabs.com">https://mclarenlabs.com</a>.</p>
<h2 id="background">Background</h2>
<p>This project is partially inspired by experiences with audio systems on IOS, OSX and Webkit.  We had in mind building a networked synthesizer using RTP-MIDI in an embedded Raspberry Pi application.  We really liked the features of modern Objective-C and thought it could provide a nice experience for audio programming.</p>
<p>We purposely chose to focus on Linux and its ALSA interface.  We wanted to avoid the layers of abstraction provided by the PortAudio project or JUCE. We also wanted to avoid dependence on a sound server like Pulse or JACK simply to reduce dependencies.  We wanted to keep the toolkit lean and easy to set up.</p>
<p>These decisions helped make the toolkit simple to use for simple things.  Along the way we learned a lot and discovered some interesting capabilities.  Hopefully this project will help share the things we learned.</p>
<h2 id="concurrency">Concurrency</h2>
<p>One of the things that makes audio programming difficult is the management of concurrency.  In an audio application like a synthesizer, there is usually a thread dedicated to rendering the audio, a thread dedicated to MIDI, a thread managing the GUI, and possibly other threads performing background tasks.</p>
<p>Apple's GCD (Grand Central Dispatch) aka "dispatch queues" help simplify concurrency, and they are a first-class part of GNUstep's Objective-C environment.  Instead of writing code that manages threads and locks, your code is organized into blocks that execute sequentially in a dispatch queue concurrency domain.  The syntactic sugar of "blocks" in C lets you write code that executes in one concurrency domain and launches an operation in another.  This replaces a cross-thread operation with something simpler.</p>
<p>One of the design goals of the McLaren Synth Kit it to elevate audio programming to the realm of dispatch events, and to hide threads and locks as much as possible.  We think we have succeeded.</p>
<h2 id="a-brief-tour-of-the-components">A Brief Tour of the Components</h2>
<p>The tool kit is divided into two layers.  The Alsa Sound Kit (ASK) provides minimal Objective-C wrappers around ALSA sound and MIDI sequencer devices.  It also encapsulates standard algorithms on these things, so that instead of writing code to play a sound or enumerate the sequencers in your system, you call a method or set up a block. </p>
<p>The major components of the Alsa Sound Kit are described below.</p>
<ul>
<li>ASKPcm - open an ALSA audio device and play or capture sounds</li>
<li>ASKPcmList - list the ALSA audio devices in your system</li>
<li>ASKSeq - open an ALSA MIDI Sequencer device and play or capture MIDI events</li>
<li>ASKSeqList - list the ALSA MIDI devices in your system</li>
</ul>
<p>The Mclaren Synth Kit (MSK) further abstracts audio devices into an object called a "Audio Context."  An Audio Context can render audio pipelines that are described as a connected graph of audio elements, each of which is called a "Voice".  A Voice can be a simple oscillator, an oscillator controlled by an envelope, or a more complex graph of multiple oscillators, envelopes and filters.  A Voice can play for ever, it can stop after a specified time or it can be sent a <code>noteOff</code> message.</p>
<p>Once created, a Voice is handed over to a Context for rendering.  The Context manages the rendering and mixing of multiple Voices.  In a typical use, a Voice is allocated for each MIDI note sounding.  When a Voice is done playing, the Context removes the Voice and arranges for the reclamation of its memory.</p>
<p>The major components of the Mclaren Synth Kit are described below.</p>
<ul>
<li>MSKContext - an audio context for rendering Voices or capturing sounds into a Voice</li>
<li>MSKLinEnvelope, MSKExpEnvelope - linear and exponential envelope generators</li>
<li>MSKSinFixedOscillator - a simple sinusoidal oscillator</li>
<li>MSKGeneralOscillator - Sin, Squarewave, Triangle, Saw oscillator</li>
<li>MSKPhaseDistortionOscillator - an oscillator who phase is controlled by another Voice</li>
</ul>
<p>The parameters of the various kinds of voices are continuously variable.  To allow multiple voices to share configuration parameters (for example, all of the notes playing in a MIDI channel to have the same "transpose" or "pitchbend" setting) the continously variable parameters of voices are separated into objects called Models. The models in the system are listed below.</p>
<ul>
<li>MSKEnvelopeModel</li>
<li>MSKOscillatorModel</li>
<li>MSKReverbModel</li>
</ul>
<blockquote>
<p>Aside: Models have a special role in the system: they provide read-only "C" variables that the Voices read from the audio thread.   And for each "C" variable, they expose an Objective-C "property" for reading and writing that variable as an <code>NSNumber</code> Object.  Essentially, they models are responsible for "boxing" and "unboxing" values.  Models also know how to save and restore their state in <code>NSUserDefaults</code>.</p>
</blockquote>
<p>To round out the system, there is also a Metronome utility.  The Metronome allocates an ALSA MIDI Sequencer and uses the MIDI event queue to schedule Metronome events.  The Metronome produces callbacks on the beat and clock frequency.  The parameters of the Metronome are continuously variable, and they are separated out into a Model, just as the voices are.</p>
<ul>
<li>MSKMetronome</li>
<li>MSKMetronomeModel</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
